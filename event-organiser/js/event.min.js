var eo_occurrences_by_rule=[],eo_include_dates,eo_exclude_dates; jQuery(document).ready(function(b){function j(){b("#eo_occurrence_includes").val(eo_include_dates.join(",\r\n"));b("#eo_occurrence_excludes").val(eo_exclude_dates.join(",\r\n"))}function m(){var a=!b("#HWSEvent_rec").prop("checked");b(".reoccurence .event-date :input").attr("disabled",a);b(".reoccurence .event-date :input").toggleClass("ui-state-disabled",a);a=!b("#eo_allday:checkbox").attr("checked");b(".eo_time").attr("disabled",!a);b(".eo_time").toggleClass("ui-state-disabled",!a);switch(b("#HWSEventInput_Req").val()){case "once":case "custom":b("#HWSEvent_freq").val("1"); b(".reocurrence_row").hide();b("#dayofweekrepeat").show();b("#dayofmonthrepeat").show();b(".reocurrence_row").attr("disabled",!0);break;case "weekly":b("#irregularrepeat").siblings().show();b(".reocurrence_row :input").attr("disabled",!1);1<b("#HWSEvent_freq").val()?b("#recpan").text(h.weeks):b("#recpan").text(h.week);b(".reocurrence_row").fadeIn(700);b("#dayofweekrepeat").fadeIn(700);b("#dayofweekrepeat :input").attr("disabled",!1);b("#dayofmonthrepeat").hide();b("#dayofmonthrepeat :radio").attr("disabled",!0);b("#irregularrepeat").hide(); break;case "monthly":b("#irregularrepeat").siblings().show();b(".reocurrence_row :input").attr("disabled",!1);1<b("#HWSEvent_freq").val()?b("#recpan").text(h.months):b("#recpan").text(h.month);b(".reocurrence_row").fadeIn(700);b("#dayofmonthrepeat").fadeIn(700);b("#dayofmonthrepeat :input").attr("disabled",!1);b("#dayofweekrepeat").hide();b("#dayofweekrepeat :input").attr("disabled",!0);b("#irregularrepeat").hide();break;case "daily":b("#irregularrepeat").siblings().show();b(".reocurrence_row :input").attr("disabled",!1);b(".reocurrence_row").fadeIn(700);1<b("#HWSEvent_freq").val()? b("#recpan").text(h.days):b("#recpan").text(h.day);b("#dayofweekrepeat").hide();b("#dayofweekrepeat :input").attr("disabled",!0);b("#dayofmonthrepeat").hide();b("#dayofmonthrepeat :radio").attr("disabled",!0);b("#irregularrepeat").hide();break;case "yearly":b("#irregularrepeat").siblings().show();b(".reocurrence_row :input").attr("disabled",!1);b(".reocurrence_row").fadeIn(700);1<b("#HWSEvent_freq").val()?b("#recpan").text(h.years):b("#recpan").text(h.year);b("#dayofweekrepeat").hide();b("#dayofweekrepeat :input").attr("disabled",!0);b("#dayofmonthrepeat").hide(); b("#dayofmonthrepeat :radio").attr("disabled",!0);b("#irregularrepeat").hide();break;case "irregular":b(".reocurrence_row :input").attr("disabled",!1),b(".reocurrence_row").fadeIn(700),b("#irregularrepeat").show();b("#irregularrepeat").siblings().hide()}null===b("#venue_select").val()&&b("tr.venue_row").hide();if("once"==b("#HWSEventInput_Req").val())b("#event_summary").html("This event will be a one-time event");else{var c=b("#from_date").datepicker("getDate"),d=EO_Ajax_Event.locale.weekDay,e="SU MO TU WE TH FR SA".split(" "), a={monthNamesShort:EO_Ajax_Event.locale.monthAbbrev,dayNamesMin:EO_Ajax_Event.locale.dayAbbrev,monthNames:EO_Ajax_Event.locale.monthNames};b("#HWSEventInput_Req :selected").text();var f=parseInt(b("#HWSEvent_freq").val()),g=h.summary+" ";switch(b("#HWSEventInput_Req").val()){case "custom":case "daily":g=1<f?g+sprintf(h.dayPlural,f):g+h.daySingle;break;case "weekly":g=1<f?g+sprintf(h.weekPlural,f):g+h.weekSingle;f=b("#dayofweekrepeat :checkbox:checked");0==f.length&&(f=c.getDay(),b("#dayofweekrepeat :checkbox[value='"+ e[f]+"']").attr("checked",!0));f=b("#dayofweekrepeat :checkbox:checked");f.each(function(a){0==a&&(g=g+" "+d[e.indexOf(b(this).val())]);0<a&&(g=g+", "+d[e.indexOf(b(this).val())])});break;case "monthly":g=1<f?g+sprintf(h.monthPlural,f):g+h.monthSingle;"BYMONTHDAY="==b("#dayofmonthrepeat :radio:checked").val()?g=g+" "+c.getDate()+n(c):(f=c.getDay()%7,c=parseInt(Math.floor((c.getDate()-1)/7)),g=g+" "+h.occurrence[c]+" "+d[f]);break;case "yearly":g=1<f?g+sprintf(h.yearPlural,f):g+h.yearSingle,g=g+" "+ b.datepicker.formatDate("MM d",c,a)+n(c)}c=b("#recend").datepicker("getDate");null!=c&&(g=g+" "+h.until+" "+b.datepicker.formatDate("MM d'"+n(c)+"' yy",c,a));b("#event_summary").html(g)}}function n(a){return["th","st","nd","rd"][3<a.getDate()&&20>a.getDate()?0:Math.min(a.getDate()%10,4)%4]}function a(){eo_exclude_dates=[];eo_include_dates=[];j();f(eo_viewing_month[0],eo_viewing_month[1],{});l.datepicker("refresh")}function c(a){a=b.datepicker.formatDate("yy-mm-dd",a);return d(a)[0]?[!0,"ui-state-active", ""]:[!0,"ui-state-disabled",""]}function d(a){if(-1<b.inArray(a,eo_occurrences_by_rule))return a=b.inArray(a,eo_exclude_dates),-1<a?[!1,a]:[!0,-1];a=b.inArray(a,eo_include_dates);return-1<a?[!0,a]:[!1,-1]}function f(a,c){eo_occurrences_by_rule=[];eo_viewing_month=[a,c];var d=b("#HWSEventInput_Req").val(),f=parseInt(b("#HWSEvent_freq").val()),e=b("#from_date").datepicker("getDate"),h=b("#recend").datepicker("getDate");c-=1;var g=new Date(a,c,1),k=new Date(new Date(a,c+1,1)-1);if(!(h<g||e>k)){switch(d){case "once":case "custom":d= b.datepicker.formatDate("yy-mm-dd",e);eo_occurrences_by_rule.push(d);return;case "daily":if(e<g)var l=Math.abs((g-e)/864E5)-1,l=l%f;else l=parseInt(e.getDate());var m=f,n=[],j=new Date(g);j.setDate(g.getDate()+(l-1));n.push(j);break;case "weekly":var p=g.getDay(),p=b("#dayofweekrepeat :checkbox:checked"),r="SU MO TU WE TH FR SA".split(" "),n=[];p.each(function(a){a=r.indexOf(b(this).val());j=new Date(e);j.setDate(e.getDate()+(a-e.getDay()+7)%7);j<g&&(l=Math.abs((g-e)/864E5),l-=l%(7*f),j.setDate(j.getDate()+ l));n.push(j)});m=7*f;break;case "monthly":if(0!=(12*(a-e.getFullYear())+c-(e.getMonth()+1))%f)return;if("BYMONTHDAY="==b('input[name="eo_input[schedule_meta]"]:checked').val()){var q=e.getDate(),k=k.getDate();q<=k&&(p=new Date(a,c,q))}else d=Math.ceil(e.getDate()/7),q=e.getDay(),5<=d?(p=k.getDay(),k=k.getDate()+(q-p-7)%7):(p=g.getDay(),k=(q-p+7)%7+7*(d-1)+1),p=new Date(g),p.setDate(k);p<=h&&(d=b.datepicker.formatDate("yy-mm-dd",p),eo_occurrences_by_rule.push(d));return;case "yearly":if(0!=(a-e.getFullYear())% f)return;k=new Date(a,e.getMonth(),e.getDate());c==e.getMonth()&&k.getMonth()==e.getMonth()&&(p=new Date(e),p.setYear(a),p<=h&&(d=b.datepicker.formatDate("yy-mm-dd",p),eo_occurrences_by_rule.push(d)));return;default:return}for(q in n)for(p=new Date(n[q]);p<=k&&p<=h;)d=b.datepicker.formatDate("yy-mm-dd",p),eo_occurrences_by_rule.push(d),p.setDate(p.getDate()+m)}}function e(a){var c=d(a);c[0]?(c=c[1],-1<c?eo_include_dates.splice(c,1):0>b.inArray(a,eo_exclude_dates)&&eo_exclude_dates.push(a)):(c=c[1], -1<c?eo_exclude_dates.splice(c,1):0>b.inArray(a,eo_include_dates)&&eo_include_dates.push(a));j()}Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c=this.length,d=Number(b)||0,d=0>d?Math.ceil(d):Math.floor(d);for(0>d&&(d+=c);d<c;d++)if(d in this&&this[d]===a)return d;return-1});0<b("#eo_occurrence_includes").length&&(eo_include_dates=b("#eo_occurrence_includes").val().split(","),eo_exclude_dates=b("#eo_occurrence_excludes").val().split(","));b(document).ready(function(){b.widget("ui.combobox", {_create:function(){var a,c=this.element.hide(),d=c.children(":selected"),d=d.val()?d.text():"",c=b("<span>").addClass("ui-combobox eo-venue-input").insertAfter(c);a=b("<input>").appendTo(c).val(d).addClass("ui-combobox-input").autocomplete({delay:0,minLength:0,source:function(a,c){b.getJSON(EO_Ajax_Event.ajaxurl+"?callback=?&action=eo-search-venue",a,function(a){a=b.map(a,function(a){a.label=a.name;return a});c(a)})},select:function(a,c){0<b("tr.venue_row").length&&(0==c.item.term_id?b("tr.venue_row").hide(): b("tr.venue_row").show(),b("#eventorganiser_event_detail tr.eo-add-new-venue").hide(),eo_initialize_map(c.item.venue_lat,c.item.venue_lng));b("#venue_select").removeAttr("selected");b("#venue_select").val(c.item.term_id)}}).addClass("ui-widget-content ui-corner-left");a.data("autocomplete")._renderItem=function(a,c){if(0==c.term_id)return b("<li></li>").data("item.autocomplete",c).append("<a>"+c.label+"</a>").appendTo(a);var d=[c.venue_address,c.venue_postal,c.venue_country],d=b.grep(d,function(a){return a}); return b("<li></li>").data("item.autocomplete",c).append("<a>"+c.label+"</br> <span style='font-size: 0.8em'><em>"+d.join(", ")+"</span></em></a>").appendTo(a)};c=b("<span>").addClass("eo-venue-combobox-buttons").appendTo(c);b("<a style='vertical-align: top;margin: 0px -1px;padding: 0px;height: 21px;'>").attr("title","Show All Items").appendTo(c).button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("ui-corner-right ui-combobox-toggle ui-combobox-button").click(function(){a.autocomplete("widget").is(":visible")? a.autocomplete("close"):(b(this).blur(),a.autocomplete("search",""),a.focus())});"event"==pagenow&&b("<a style='vertical-align: top;margin: 0px -1px;padding: 0px;height: 21px;'>").attr("title","Create New Venue").appendTo(c).button({icons:{primary:"ui-icon-plus"},text:!1}).removeClass("ui-corner-all").addClass("ui-corner-right add-new-venue ui-combobox-button").click(function(){b("#eventorganiser_event_detail tr.eo-add-new-venue").show();b("tr.venue_row").show();b("#venue_select").removeAttr("selected").val(0); b(".eo-venue-combobox-select").hide();b(".eo-venue-input input").val("");eo_initialize_map(0,0);var a=EO_Ajax_Event.location;a?(a=a.split("/"),a=a[a.length-1],eventorganiser_code_address(a)):map.setZoom(1);b(this).blur()})}});b("#venue_select").combobox()});b(".eo-add-new-venue-cancel").click(function(a){a.preventDefault();b(".eo-venue-combobox-select").show();b(".eo-add-new-venue input").val("");b("#eventorganiser_event_detail tr.eo-add-new-venue").hide();b("#eventorganiser_event_detail tr.venue_row ").hide()}); var h=EO_Ajax_Event.locale;if(0<b("#eventorganiser_detail #from_date, #eventorganiser_detail #to_date").length){var g=b("#eventorganiser_detail #from_date, #eventorganiser_detail #to_date").datepicker({dateFormat:EO_Ajax_Event.format,changeMonth:!0,changeYear:!0,monthNamesShort:EO_Ajax_Event.locale.monthAbbrev,dayNamesMin:EO_Ajax_Event.locale.dayAbbrev,firstDay:parseInt(EO_Ajax_Event.startday),buttonImage:"images/ui-icon-calendar.png",onSelect:function(c){var d="from_date"==this.id?"minDate":"maxDate", e=b(this).data("datepicker");c=b.datepicker.parseDate(e.settings.dateFormat||b.datepicker._defaults.dateFormat,c,e.settings);g.not(this).datepicker("option",d,c);"from_date"==this.id&&b("#recend").datepicker("option","minDate",c);a();m()}});b("#recend").datepicker({dateFormat:EO_Ajax_Event.format,monthNamesShort:EO_Ajax_Event.locale.monthAbbrev,dayNamesMin:EO_Ajax_Event.locale.dayAbbrev,changeMonth:!0,changeYear:!0,firstDay:parseInt(EO_Ajax_Event.startday)});b("#HWSEvent_time, #HWSEvent_time2").timepicker({showPeriodLabels:!1, hourText:EO_Ajax_Event.locale.hour,minuteText:EO_Ajax_Event.locale.minute});b("#HWSEvent_rec").click(function(){m()});b(".reoccurence .event-date :input, .onetime .event-date :input").not(".eo_time").change(function(){m();"eo_allday"!=b(this).attr("id")&&a()});m();var k=!b(this).prop("checked");b(".reoccurence .event-date :input").attr("disabled",k);b(".reoccurence .event-date :input").toggleClass("ui-state-disabled",k)}b(".eo_occurrence_toogle").click(function(a){a.preventDefault();a.stopPropagation(); l.toggle()});k=new Date;f(k.getFullYear(),k.getMonth()+1,{});var l=b("#eo_occurrence_datepicker");0<l.length&&l.datepicker({dateFormat:"yy-mm-dd",onSelect:e,beforeShowDay:c,onChangeMonthYear:f,changeMonth:!0,changeYear:!0,monthNamesShort:EO_Ajax_Event.locale.monthAbbrev,dayNamesMin:EO_Ajax_Event.locale.dayAbbrev,firstDay:parseInt(EO_Ajax_Event.startday)}).hide();b("html").click(function(){l.hide()});l.find(".ui-datepicker-inline").click(function(a){a||(a=window.event);a.cancelBubble=!0;a.stopPropagation&& a.stopPropagation()});var k=jQuery("#irregularrepeat"),r=jQuery("#irregularTemplate").clone();r.children("td").children("input").removeClass("ui-state-disabled");r.children("td").children("input").removeClass("ui-state-disabled");r.removeAttr("id");r.find("input").removeAttr("disabled");k.on("click","a",function(){return!1});k.on("click","#addIrregularEvent",function(){clone=jQuery("#irregularrepeat tbody").append(r.clone())});k.on("click",".removeIrregularEvent",function(a){jQuery(a.target).closest("tr").remove()})}); var sprintf=function(){function b(b){return Object.prototype.toString.call(b).slice(8,-1).toLowerCase()}var j=function(){j.cache.hasOwnProperty(arguments[0])||(j.cache[arguments[0]]=j.parse(arguments[0]));return j.format.call(null,j.cache[arguments[0]],arguments)};j.format=function(j,n){var a=1,c=j.length,d="",f=[],e,h,g,k;for(e=0;e<c;e++)if(d=b(j[e]),"string"===d)f.push(j[e]);else if("array"===d){g=j[e];if(g[2]){d=n[a];for(h=0;h<g[2].length;h++){if(!d.hasOwnProperty(g[2][h]))throw sprintf('[sprintf] property "%s" does not exist', g[2][h]);d=d[g[2][h]]}}else d=g[1]?n[g[1]]:n[a++];if(/[^s]/.test(g[8])&&"number"!=b(d))throw sprintf("[sprintf] expecting number but found %s",b(d));switch(g[8]){case "b":d=d.toString(2);break;case "c":d=String.fromCharCode(d);break;case "d":d=parseInt(d,10);break;case "e":d=g[7]?d.toExponential(g[7]):d.toExponential();break;case "f":d=g[7]?parseFloat(d).toFixed(g[7]):parseFloat(d);break;case "o":d=d.toString(8);break;case "s":d=(d=String(d))&&g[7]?d.substring(0,g[7]):d;break;case "u":d=Math.abs(d); break;case "x":d=d.toString(16);break;case "X":d=d.toString(16).toUpperCase()}d=/[def]/.test(g[8])&&g[3]&&0<=d?"+"+d:d;h=g[4]?"0"==g[4]?"0":g[4].charAt(1):" ";k=g[6]-String(d).length;if(g[6]){for(var l=[];0<k;l[--k]=h);h=l.join("")}else h="";f.push(g[5]?d+h:h+d)}return f.join("")};j.cache={};j.parse=function(b){for(var j=[],a=[],c=0;b;){if(null!==(j=/^[^\x25]+/.exec(b)))a.push(j[0]);else if(null!==(j=/^\x25{2}/.exec(b)))a.push("%");else if(null!==(j=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(b))){if(j[2]){var c= c|1,d=[],f=j[2],e=[];if(null!==(e=/^([a-z_][a-z_\d]*)/i.exec(f)))for(d.push(e[1]);""!==(f=f.substring(e[0].length));)if(null!==(e=/^\.([a-z_][a-z_\d]*)/i.exec(f)))d.push(e[1]);else if(null!==(e=/^\[(\d+)\]/.exec(f)))d.push(e[1]);else throw"[sprintf] huh?";else throw"[sprintf] huh?";j[2]=d}else c|=2;if(3===c)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";a.push(j)}else throw"[sprintf] huh?";b=b.substring(j[0].length)}return a};return j}(),vsprintf=function(b,j){j.unshift(b); return sprintf.apply(null,j)}; (function(b){function j(){this._curInst=null;this._disabledInputs=[];this._inDialog=this._timepickerShowing=!1;this._dialogClass="ui-timepicker-dialog";this._mainDivId="ui-timepicker-div";this._inlineClass="ui-timepicker-inline";this._currentClass="ui-timepicker-current";this._dayOverClass="ui-timepicker-days-cell-over";this.regional=[];this.regional[""]={hourText:"Hour",minuteText:"Minute",amPmText:["AM","PM"],closeButtonText:"Done",nowButtonText:"Now",deselectButtonText:"Deselect"};this._defaults= {showOn:"focus",button:null,showAnim:"fadeIn",showOptions:{},appendText:"",beforeShow:null,onSelect:null,onClose:null,timeSeparator:":",periodSeparator:" ",showPeriod:!1,showPeriodLabels:!0,showLeadingZero:!0,showMinutesLeadingZero:!0,altField:"",defaultTime:"now",myPosition:"left top",atPosition:"left bottom",onHourShow:null,onMinuteShow:null,hours:{starts:0,ends:23},minutes:{starts:0,ends:55,interval:5},rows:4,showHours:!0,showMinutes:!0,optionalMinutes:!1,showCloseButton:!1,showNowButton:!1,showDeselectButton:!1}; b.extend(this._defaults,this.regional[""]);this.tpDiv=b('<div id="'+this._mainDivId+'" class="ui-timepicker ui-widget ui-helper-clearfix ui-corner-all " style="display: none"></div>')}function m(a,c){b.extend(a,c);for(var d in c)if(null==c[d]||void 0==c[d])a[d]=c[d];return a}b.extend(b.ui,{timepicker:{version:"0.3.1"}});var n=(new Date).getTime();b.extend(j.prototype,{markerClassName:"hasTimepicker",log:function(){},_widgetTimepicker:function(){return this.tpDiv},setDefaults:function(a){m(this._defaults, a||{});return this},_attachTimepicker:function(a,c){var d=null,f;for(f in this._defaults){var e=a.getAttribute("time:"+f);if(e){d=d||{};try{d[f]=eval(e)}catch(h){d[f]=e}}}f=a.nodeName.toLowerCase();e="div"==f||"span"==f;a.id||(this.uuid+=1,a.id="tp"+this.uuid);var g=this._newInst(b(a),e);g.settings=b.extend({},c||{},d||{});"input"==f?(this._connectTimepicker(a,g),this._setTimeFromField(g)):e&&this._inlineTimepicker(a,g)},_newInst:function(a,c){return{id:a[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"), input:a,inline:c,tpDiv:!c?this.tpDiv:b('<div class="'+this._inlineClass+' ui-timepicker ui-widget ui-helper-clearfix"></div>')}},_connectTimepicker:function(a,c){var d=b(a);c.append=b([]);c.trigger=b([]);d.hasClass(this.markerClassName)||(this._attachments(d,c),d.addClass(this.markerClassName).keydown(this._doKeyDown).keyup(this._doKeyUp).bind("setData.timepicker",function(a,b,d){c.settings[b]=d}).bind("getData.timepicker",function(a,b){return this._get(c,b)}),b.data(a,"timepicker",c))},_doKeyDown:function(a){var c= b.timepicker._getInst(a.target),d=!0;c._keyEvent=!0;if(b.timepicker._timepickerShowing)switch(a.keyCode){case 9:b.timepicker._hideTimepicker();d=!1;break;case 13:return b.timepicker._updateSelectedValue(c),b.timepicker._hideTimepicker(),!1;case 27:b.timepicker._hideTimepicker();break;default:d=!1}else 36==a.keyCode&&a.ctrlKey?b.timepicker._showTimepicker(this):d=!1;d&&(a.preventDefault(),a.stopPropagation())},_doKeyUp:function(a){a=b.timepicker._getInst(a.target);b.timepicker._setTimeFromField(a); b.timepicker._updateTimepicker(a)},_attachments:function(a,c){var d=this._get(c,"appendText"),f=this._get(c,"isRTL");c.append&&c.append.remove();d&&(c.append=b('<span class="'+this._appendClass+'">'+d+"</span>"),a[f?"before":"after"](c.append));a.unbind("focus.timepicker",this._showTimepicker);a.unbind("click.timepicker",this._adjustZIndex);c.trigger&&c.trigger.remove();d=this._get(c,"showOn");if("focus"==d||"both"==d)a.bind("focus.timepicker",this._showTimepicker),a.bind("click.timepicker",this._adjustZIndex); if("button"==d||"both"==d)d=this._get(c,"button"),b(d).bind("click.timepicker",function(){b.timepicker._timepickerShowing&&b.timepicker._lastInput==a[0]?b.timepicker._hideTimepicker():c.input.is(":disabled")||b.timepicker._showTimepicker(a[0]);return!1})},_inlineTimepicker:function(a,c){var d=b(a);d.hasClass(this.markerClassName)||(d.addClass(this.markerClassName).append(c.tpDiv).bind("setData.timepicker",function(a,b,d){c.settings[b]=d}).bind("getData.timepicker",function(a,b){return this._get(c, b)}),b.data(a,"timepicker",c),this._setTimeFromField(c),this._updateTimepicker(c),c.tpDiv.show())},_adjustZIndex:function(a){a=a.target||a;b.timepicker._getInst(a).tpDiv.css("zIndex",b.timepicker._getZIndex(a)+1)},_showTimepicker:function(a){a=a.target||a;"input"!=a.nodeName.toLowerCase()&&(a=b("input",a.parentNode)[0]);if(!(b.timepicker._isDisabledTimepicker(a)||b.timepicker._lastInput==a)){b.timepicker._hideTimepicker();var c=b.timepicker._getInst(a);b.timepicker._curInst&&b.timepicker._curInst!= c&&b.timepicker._curInst.tpDiv.stop(!0,!0);var d=b.timepicker._get(c,"beforeShow");m(c.settings,d?d.apply(a,[a,c]):{});c.lastVal=null;b.timepicker._lastInput=a;b.timepicker._setTimeFromField(c);b.timepicker._inDialog&&(a.value="");b.timepicker._pos||(b.timepicker._pos=b.timepicker._findPos(a),b.timepicker._pos[1]+=a.offsetHeight);var f=!1;b(a).parents().each(function(){f|="fixed"==b(this).css("position");return!f});f&&b.browser.opera&&(b.timepicker._pos[0]-=document.documentElement.scrollLeft,b.timepicker._pos[1]-= document.documentElement.scrollTop);d={left:b.timepicker._pos[0],top:b.timepicker._pos[1]};b.timepicker._pos=null;c.tpDiv.css({position:"absolute",display:"block",top:"-1000px"});b.timepicker._updateTimepicker(c);!c.inline&&"object"==typeof b.ui.position&&(c.tpDiv.position({of:c.input,my:b.timepicker._get(c,"myPosition"),at:b.timepicker._get(c,"atPosition"),collision:"flip"}),d=c.tpDiv.offset(),b.timepicker._pos=[d.top,d.left]);c._hoursClicked=!1;c._minutesClicked=!1;d=b.timepicker._checkOffset(c, d,f);c.tpDiv.css({position:b.timepicker._inDialog&&b.blockUI?"static":f?"fixed":"absolute",display:"none",left:d.left+"px",top:d.top+"px"});if(!c.inline){var d=b.timepicker._get(c,"showAnim"),e=b.timepicker._get(c,"duration"),h=function(){b.timepicker._timepickerShowing=!0;var a=b.timepicker._getBorders(c.tpDiv);c.tpDiv.find("iframe.ui-timepicker-cover").css({left:-a[0],top:-a[1],width:c.tpDiv.outerWidth(),height:c.tpDiv.outerHeight()})};b.timepicker._adjustZIndex(a);if(b.effects&&b.effects[d])c.tpDiv.show(d, b.timepicker._get(c,"showOptions"),e,h);else c.tpDiv[d||"show"](d?e:null,h);(!d||!e)&&h();c.input.is(":visible")&&!c.input.is(":disabled")&&c.input.focus();b.timepicker._curInst=c}}},_getZIndex:function(a){a=b(a);for(var c;a.length&&a[0]!==document;){c=a.css("position");if("absolute"===c||"relative"===c||"fixed"===c)if(c=parseInt(a.css("zIndex"),10),!isNaN(c)&&0!==c)return c;a=a.parent()}},_refreshTimepicker:function(a){(a=this._getInst(a))&&this._updateTimepicker(a)},_updateTimepicker:function(a){a.tpDiv.empty().append(this._generateHTML(a)); this._rebindDialogEvents(a)},_rebindDialogEvents:function(a){var c=b.timepicker._getBorders(a.tpDiv),d=this;a.tpDiv.find("iframe.ui-timepicker-cover").css({left:-c[0],top:-c[1],width:a.tpDiv.outerWidth(),height:a.tpDiv.outerHeight()}).end().find(".ui-timepicker-minute-cell").unbind().bind("click",{fromDoubleClick:!1},b.proxy(b.timepicker.selectMinutes,this)).bind("dblclick",{fromDoubleClick:!0},b.proxy(b.timepicker.selectMinutes,this)).end().find(".ui-timepicker-hour-cell").unbind().bind("click", {fromDoubleClick:!1},b.proxy(b.timepicker.selectHours,this)).bind("dblclick",{fromDoubleClick:!0},b.proxy(b.timepicker.selectHours,this)).end().find(".ui-timepicker td a").unbind().bind("mouseout",function(){b(this).removeClass("ui-state-hover");-1!=this.className.indexOf("ui-timepicker-prev")&&b(this).removeClass("ui-timepicker-prev-hover");-1!=this.className.indexOf("ui-timepicker-next")&&b(this).removeClass("ui-timepicker-next-hover")}).bind("mouseover",function(){if(!d._isDisabledTimepicker(a.inline? a.tpDiv.parent()[0]:a.input[0]))b(this).parents(".ui-timepicker-calendar").find("a").removeClass("ui-state-hover"),b(this).addClass("ui-state-hover"),-1!=this.className.indexOf("ui-timepicker-prev")&&b(this).addClass("ui-timepicker-prev-hover"),-1!=this.className.indexOf("ui-timepicker-next")&&b(this).addClass("ui-timepicker-next-hover")}).end().find("."+this._dayOverClass+" a").trigger("mouseover").end().find(".ui-timepicker-now").bind("click",function(a){b.timepicker.selectNow(a)}).end().find(".ui-timepicker-deselect").bind("click", function(a){b.timepicker.deselectTime(a)}).end().find(".ui-timepicker-close").bind("click",function(){b.timepicker._hideTimepicker()}).end()},_generateHTML:function(a){var c,d,f,e,h=!0==this._get(a,"showPeriod"),g=!0==this._get(a,"showPeriodLabels"),k=!0==this._get(a,"showLeadingZero");d=!0==this._get(a,"showHours");var j=!0==this._get(a,"showMinutes"),r=this._get(a,"amPmText"),n=this._get(a,"rows"),m=0,u=0,v=e=0,x=0,w=0,s=[],y=this._get(a,"hours");c=null;var t=0;f=this._get(a,"hourText");var z=this._get(a, "showCloseButton"),C=this._get(a,"closeButtonText"),A=this._get(a,"showNowButton"),p=this._get(a,"nowButtonText"),B=this._get(a,"showDeselectButton"),q=this._get(a,"deselectButtonText"),D=z||A||B;for(c=y.starts;c<=y.ends;c++)s.push(c);c=Math.ceil(s.length/n);if(g){for(t=0;t<s.length;t++)12>s[t]?e++:v++;t=0;m=Math.floor(e/s.length*n);u=Math.floor(v/s.length*n);n!=m+u&&(e&&(!v||!m||u&&e/m>=v/u)?m++:u++);x=Math.min(m,1);w=m+1;c=Math.ceil(Math.max(e/m,v/u))}e='<table class="ui-timepicker-table ui-widget-content ui-corner-all"><tr>'; if(d){e+='<td class="ui-timepicker-hours"><div class="ui-timepicker-title ui-widget-header ui-helper-clearfix ui-corner-all">'+f+'</div><table class="ui-timepicker">';for(d=1;d<=n;d++){e+="<tr>";d==x&&g&&(e+='<th rowspan="'+m.toString()+'" class="periods" scope="row">'+r[0]+"</th>");d==w&&g&&(e+='<th rowspan="'+u.toString()+'" class="periods" scope="row">'+r[1]+"</th>");for(f=1;f<=c;f++)g&&d<w&&12<=s[t]?e+=this._generateHTMLHourCell(a,void 0,h,k):(e+=this._generateHTMLHourCell(a,s[t],h,k),t++);e+= "</tr>"}e+="</tr></table></td>"}j&&(e=e+'<td class="ui-timepicker-minutes">'+this._generateHTMLMinutes(a),e+="</td>");e+="</tr>";D&&(h='<tr><td colspan="3"><div class="ui-timepicker-buttonpane ui-widget-content">',A&&(h+='<button type="button" class="ui-timepicker-now ui-state-default ui-corner-all" data-timepicker-instance-id="#'+a.id.replace(/\\\\/g,"\\")+'" >'+p+"</button>"),B&&(h+='<button type="button" class="ui-timepicker-deselect ui-state-default ui-corner-all" data-timepicker-instance-id="#'+ a.id.replace(/\\\\/g,"\\")+'" >'+q+"</button>"),z&&(h+='<button type="button" class="ui-timepicker-close ui-state-default ui-corner-all" data-timepicker-instance-id="#'+a.id.replace(/\\\\/g,"\\")+'" >'+C+"</button>"),e+=h+"</div></td></tr>");e+="</table>";return e+=b.browser.msie&&7>parseInt(b.browser.version,10)&&!a.inline?'<iframe src="javascript:false;" class="ui-timepicker-cover" frameborder="0"></iframe>':""},_updateMinuteDisplay:function(a){var b=this._generateHTMLMinutes(a);a.tpDiv.find("td.ui-timepicker-minutes").html(b); this._rebindDialogEvents(a)},_generateHTMLMinutes:function(a){var b,d,f="",e=this._get(a,"rows"),h=[];d=this._get(a,"minutes");var g=null,k=0,j=!0==this._get(a,"showMinutesLeadingZero"),m=this._get(a,"onMinuteShow"),n=this._get(a,"minuteText");d.starts||(d.starts=0);d.ends||(d.ends=59);for(b=d.starts;b<=d.ends;b+=d.interval)h.push(b);g=Math.round(h.length/e+0.49);if(m&&!1==m.apply(a.input?a.input[0]:null,[a.hours,a.minutes]))for(k=0;k<h.length;k+=1)if(b=h[k],m.apply(a.input?a.input[0]:null,[a.hours, b])){a.minutes=b;break}f+='<div class="ui-timepicker-title ui-widget-header ui-helper-clearfix ui-corner-all">'+n+'</div><table class="ui-timepicker">';k=0;for(d=1;d<=e;d++){for(f+="<tr>";k<d*g;)b=h[k],m="",void 0!==b&&(m=10>b&&j?"0"+b.toString():b.toString()),f+=this._generateHTMLMinuteCell(a,b,m),k++;f+="</tr>"}return f+"</table>"},_generateHTMLHourCell:function(a,b,d,f){var e=b;12<b&&d&&(e=b-12);0==e&&d&&(e=12);10>e&&f&&(e="0"+e);d="";d=!0;f=this._get(a,"onHourShow");if(void 0==b)return'<td><span class="ui-state-default ui-state-disabled">&nbsp;</span></td>'; f&&(d=f.apply(a.input?a.input[0]:null,[b]));return d=d?'<td class="ui-timepicker-hour-cell" data-timepicker-instance-id="#'+a.id.replace(/\\\\/g,"\\")+'" data-hour="'+b.toString()+'"><a class="ui-state-default '+(b==a.hours?"ui-state-active":"")+'">'+e.toString()+"</a></td>":'<td><span class="ui-state-default ui-state-disabled '+(b==a.hours?" ui-state-active ":" ")+'">'+e.toString()+"</span></td>"},_generateHTMLMinuteCell:function(a,b,d){var f="",f=!0,e=this._get(a,"onMinuteShow");e&&(f=e.apply(a.input? a.input[0]:null,[a.hours,b]));return void 0==b?'<td><span class="ui-state-default ui-state-disabled">&nbsp;</span></td>':f=f?'<td class="ui-timepicker-minute-cell" data-timepicker-instance-id="#'+a.id.replace(/\\\\/g,"\\")+'" data-minute="'+b.toString()+'" ><a class="ui-state-default '+(b==a.minutes?"ui-state-active":"")+'" >'+d+"</a></td>":'<td><span class="ui-state-default ui-state-disabled" >'+d+"</span></td>"},_destroyTimepicker:function(a){var c=b(a),d=b.data(a,"timepicker");if(c.hasClass(this.markerClassName)){var f= a.nodeName.toLowerCase();b.removeData(a,"timepicker");"input"==f?(d.append.remove(),d.trigger.remove(),c.removeClass(this.markerClassName).unbind("focus.timepicker",this._showTimepicker).unbind("click.timepicker",this._adjustZIndex)):("div"==f||"span"==f)&&c.removeClass(this.markerClassName).empty()}},_enableTimepicker:function(a){var c=b(a),d=c.attr("id"),f=b.data(a,"timepicker");if(c.hasClass(this.markerClassName)){var e=a.nodeName.toLowerCase();if("input"==e)a.disabled=!1,a=this._get(f,"button"), b(a).removeClass("ui-state-disabled").disabled=!1,f.trigger.filter("button").each(function(){this.disabled=!1}).end();else if("div"==e||"span"==e)f=c.children("."+this._inlineClass),f.children().removeClass("ui-state-disabled"),f.find("button").each(function(){this.disabled=!1});this._disabledInputs=b.map(this._disabledInputs,function(a){return a==d?null:a})}},_disableTimepicker:function(a){var c=b(a),d=b.data(a,"timepicker");if(c.hasClass(this.markerClassName)){var f=a.nodeName.toLowerCase();if("input"== f)f=this._get(d,"button"),b(f).addClass("ui-state-disabled").disabled=!0,a.disabled=!0,d.trigger.filter("button").each(function(){this.disabled=!0}).end();else if("div"==f||"span"==f)d=c.children("."+this._inlineClass),d.children().addClass("ui-state-disabled"),d.find("button").each(function(){this.disabled=!0});this._disabledInputs=b.map(this._disabledInputs,function(b){return b==a?null:b});this._disabledInputs[this._disabledInputs.length]=c.attr("id")}},_isDisabledTimepicker:function(a){if(!a)return!1; for(var b=0;b<this._disabledInputs.length;b++)if(this._disabledInputs[b]==a)return!0;return!1},_checkOffset:function(a,c,d){var f=a.tpDiv.outerWidth(),e=a.tpDiv.outerHeight(),h=a.input?a.input.outerWidth():0,g=a.input?a.input.outerHeight():0,k=document.documentElement.clientWidth+b(document).scrollLeft(),j=document.documentElement.clientHeight+b(document).scrollTop();c.left-=this._get(a,"isRTL")?f-h:0;c.left-=d&&c.left==a.input.offset().left?b(document).scrollLeft():0;c.top-=d&&c.top==a.input.offset().top+ g?b(document).scrollTop():0;c.left-=Math.min(c.left,c.left+f>k&&k>f?Math.abs(c.left+f-k):0);c.top-=Math.min(c.top,c.top+e>j&&j>e?Math.abs(e+g):0);return c},_findPos:function(a){for(var c=this._getInst(a),c=this._get(c,"isRTL");a&&("hidden"==a.type||1!=a.nodeType);)a=a[c?"previousSibling":"nextSibling"];a=b(a).offset();return[a.left,a.top]},_getBorders:function(a){var b=function(a){return{thin:1,medium:2,thick:3}[a]||a};return[parseFloat(b(a.css("border-left-width"))),parseFloat(b(a.css("border-top-width")))]}, _checkExternalClick:function(a){b.timepicker._curInst&&(a=b(a.target),a[0].id!=b.timepicker._mainDivId&&(0==a.parents("#"+b.timepicker._mainDivId).length&&!a.hasClass(b.timepicker.markerClassName)&&!a.hasClass(b.timepicker._triggerClass)&&b.timepicker._timepickerShowing&&(!b.timepicker._inDialog||!b.blockUI))&&b.timepicker._hideTimepicker())},_hideTimepicker:function(a){var c=this._curInst;if(c&&!(a&&c!=b.data(a,"timepicker"))&&this._timepickerShowing){a=this._get(c,"showAnim");var d=this._get(c, "duration"),f=function(){b.timepicker._tidyDialog(c);this._curInst=null};if(b.effects&&b.effects[a])c.tpDiv.hide(a,b.timepicker._get(c,"showOptions"),d,f);else c.tpDiv["slideDown"==a?"slideUp":"fadeIn"==a?"fadeOut":"hide"](a?d:null,f);a||f();this._timepickerShowing=!1;this._lastInput=null;this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),b.blockUI&&(b.unblockUI(),b("body").append(this.tpDiv)));this._inDialog=!1;(a=this._get(c,"onClose"))&&a.apply(c.input?c.input[0]: null,[c.input?c.input.val():"",c])}},_tidyDialog:function(a){a.tpDiv.removeClass(this._dialogClass).unbind(".ui-timepicker")},_getInst:function(a){try{return b.data(a,"timepicker")}catch(c){throw"Missing instance data for this timepicker";}},_get:function(a,b){return void 0!==a.settings[b]?a.settings[b]:this._defaults[b]},_setTimeFromField:function(a){if(a.input.val()!=a.lastVal){var c=this._get(a,"defaultTime"),c="now"==c?this._getCurrentTimeRounded(a):c;!1==a.inline&&""!=a.input.val()&&(c=a.input.val()); if(c instanceof Date)a.hours=c.getHours(),a.minutes=c.getMinutes();else{var d=a.lastVal=c;""==c?(a.hours=-1,a.minutes=-1):(c=this.parseTime(a,d),a.hours=c.hours,a.minutes=c.minutes)}b.timepicker._updateTimepicker(a)}},_optionTimepicker:function(a,c,d){var f=this._getInst(a);if(2==arguments.length&&"string"==typeof c)return"defaults"==c?b.extend({},b.timepicker._defaults):f?"all"==c?b.extend({},f.settings):this._get(f,c):null;var e=c||{};"string"==typeof c&&(e={},e[c]=d);f&&(this._curInst==f&&this._hideTimepicker(), m(f.settings,e),this._updateTimepicker(f))},_setTimeTimepicker:function(a,b){var d=this._getInst(a);d&&(this._setTime(d,b),this._updateTimepicker(d),this._updateAlternate(d,b))},_setTime:function(a,b,d){var f=a.hours,e=a.minutes;b=this.parseTime(a,b);a.hours=b.hours;a.minutes=b.minutes;(f!=a.hours||e!=a.minuts)&&!d&&a.input.trigger("change");this._updateTimepicker(a);this._updateSelectedValue(a)},_getCurrentTimeRounded:function(){var a=new Date,b=a.getMinutes(),b=5*Math.round(b/5);a.setMinutes(b); return a},parseTime:function(a,b){var d={hours:-1,minutes:-1},f=this._get(a,"timeSeparator"),e=this._get(a,"amPmText"),h=this._get(a,"showHours"),g=this._get(a,"showMinutes"),j=this._get(a,"optionalMinutes"),l=!0==this._get(a,"showPeriod"),f=b.indexOf(f);-1!=f?(d.hours=parseInt(b.substr(0,f),10),d.minutes=parseInt(b.substr(f+1),10)):h&&(!g||j)?d.hours=parseInt(b,10):!h&&g&&(d.minutes=parseInt(b,10));h&&(h=b.toUpperCase(),12>d.hours&&(l&&-1!=h.indexOf(e[1].toUpperCase()))&&(d.hours+=12),12==d.hours&& (l&&-1!=h.indexOf(e[0].toUpperCase()))&&(d.hours=0));return d},selectNow:function(a){a=b(a.target).attr("data-timepicker-instance-id");a=b(a);a=this._getInst(a[0]);var c=new Date;a.hours=c.getHours();a.minutes=c.getMinutes();this._updateSelectedValue(a);this._updateTimepicker(a);this._hideTimepicker()},deselectTime:function(a){a=b(a.target).attr("data-timepicker-instance-id");a=b(a);a=this._getInst(a[0]);a.hours=-1;a.minutes=-1;this._updateSelectedValue(a);this._hideTimepicker()},selectHours:function(a){var c= b(a.currentTarget),d=c.attr("data-timepicker-instance-id"),f=parseInt(c.attr("data-hour"));a=a.data.fromDoubleClick;var d=b(d),e=this._getInst(d[0]),h=!0==this._get(e,"showMinutes");if(b.timepicker._isDisabledTimepicker(d.attr("id")))return!1;c.parents(".ui-timepicker-hours:first").find("a").removeClass("ui-state-active");c.children("a").addClass("ui-state-active");e.hours=f;this._get(e,"onMinuteShow")&&this._updateMinuteDisplay(e);this._updateSelectedValue(e);e._hoursClicked=!0;(e._minutesClicked|| a||!1==h)&&b.timepicker._hideTimepicker();return!1},selectMinutes:function(a){var c=b(a.currentTarget),d=c.attr("data-timepicker-instance-id"),f=parseInt(c.attr("data-minute"));a=a.data.fromDoubleClick;var d=b(d),e=this._getInst(d[0]),h=!0==this._get(e,"showHours");if(b.timepicker._isDisabledTimepicker(d.attr("id")))return!1;c.parents(".ui-timepicker-minutes:first").find("a").removeClass("ui-state-active");c.children("a").addClass("ui-state-active");e.minutes=f;this._updateSelectedValue(e);e._minutesClicked= !0;(e._hoursClicked||a||!1==h)&&b.timepicker._hideTimepicker();return!1},_updateSelectedValue:function(a){var b=this._getParsedTime(a);a.input&&(a.input.val(b),a.input.trigger("change"));var d=this._get(a,"onSelect");d&&d.apply(a.input?a.input[0]:null,[b,a]);this._updateAlternate(a,b);return b},_getParsedTime:function(a){if(-1==a.hours&&-1==a.minutes)return"";if(a.hours<a.hours.starts||a.hours>a.hours.ends)a.hours=0;if(a.minutes<a.minutes.starts||a.minutes>a.minutes.ends)a.minutes=0;var b="",d=!0== this._get(a,"showPeriod"),f=!0==this._get(a,"showLeadingZero"),e=!0==this._get(a,"showHours"),h=!0==this._get(a,"showMinutes"),g=!0==this._get(a,"optionalMinutes"),j=this._get(a,"amPmText"),l=a.hours?a.hours:0,m=a.minutes?a.minutes:0,n=l?l:0,l="";d&&(0==a.hours&&(n=12),12>a.hours?b=j[0]:(b=j[1],12<n&&(n-=12)));d=n.toString();f&&10>n&&(d="0"+d);f=m.toString();10>m&&(f="0"+f);e&&(l+=d);if(e&&h&&(!g||0!=f))l+=this._get(a,"timeSeparator");if(h&&(!g||0!=f))l+=f;e&&0<b.length&&(l+=this._get(a,"periodSeparator")+ b);return l},_updateAlternate:function(a,c){var d=this._get(a,"altField");d&&b(d).each(function(a,d){b(d).val(c)})},_getTimeTimepicker:function(a){a=this._getInst(a);return this._getParsedTime(a)},_getHourTimepicker:function(a){a=this._getInst(a);return void 0==a?-1:a.hours},_getMinuteTimepicker:function(a){a=this._getInst(a);return void 0==a?-1:a.minutes}});b.fn.timepicker=function(a){b.timepicker.initialized||(b(document).mousedown(b.timepicker._checkExternalClick).find("body").append(b.timepicker.tpDiv), b.timepicker.initialized=!0);var c=Array.prototype.slice.call(arguments,1);return"string"==typeof a&&("getTime"==a||"getHour"==a||"getMinute"==a)||"option"==a&&2==arguments.length&&"string"==typeof arguments[1]?b.timepicker["_"+a+"Timepicker"].apply(b.timepicker,[this[0]].concat(c)):this.each(function(){"string"==typeof a?b.timepicker["_"+a+"Timepicker"].apply(b.timepicker,[this].concat(c)):b.timepicker._attachTimepicker(this,a)})};b.timepicker=new j;b.timepicker.initialized=!1;b.timepicker.uuid= (new Date).getTime();b.timepicker.version="0.3.1";window["TP_jQuery_"+n]=b})(jQuery);
